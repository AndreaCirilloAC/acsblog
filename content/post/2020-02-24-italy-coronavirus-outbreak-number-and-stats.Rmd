---
title: 'Italy Coronavirus Outbreak: numbers and stats'
author: Andrea Cirillo
date: '2020-02-24'
slug: italy-coronavirus-outbreak-number-and-stats
categories: []
tags: 
  - dataviz
  - data analysis
  - data analytics
output: 
  html_document: 
    fig_width: 10
---

```{r eval=TRUE, echo=FALSE, warning=FALSE, message= FALSE}
library(rio)
library(tidyverse)
library(lubridate)

world_data <- import("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv")
Lombardy_data <- import("https://raw.githubusercontent.com/AndreaCirilloAC/acsblog/master/static/NCOV-19%20-%20data.csv",
                     sep = ",") %>% 
  mutate(date = lubridate::parse_date_time(day,"dmy")) %>% 
  select(date,`confirmed Lombardy`)

italy_data <- import("https://raw.githubusercontent.com/AndreaCirilloAC/acsblog/master/static/NCOV-19%20-%20data.csv", sep = ",") %>% 
  mutate(date = lubridate::parse_date_time(day,"dmy")) %>%
  select(date,confirmed, deaths)

hubei <- world_data %>% 
  select(-c(Lat, Long)) %>% 
  gather(key= "date", value = "confirmed", -c(`Province/State`, `Country/Region`)) %>% 
    janitor::clean_names() %>% 
  mutate(date = lubridate::parse_date_time(date,"mdy"),
         confirmed_hubei = confirmed) %>%
  filter(province_state == "Hubei") %>% 
  select(date,confirmed_hubei) 
n_hubei <- nrow(hubei)  
hubei %>% 
mutate(t = seq(from =1,
               to = n_hubei,
               by = 1)) %>%
# mutate(t = seq(from =10,
#                to = n_hubei+9,
#                by = 1)) %>% 
  select(-date)-> hubei_mined


n_lombardy <- nrow(Lombardy_data)

Lombardy_data %>% 
  mutate(t = seq(from =1,
               to = n_lombardy,
               by = 1)) %>% 
  select(-date)-> lombardy

hubei_mined %>% 
  left_join(lombardy) %>% 
  mutate(delta_lombardy = c(0,diff(`confirmed Lombardy`)),
         delta_hubei    = c(0,diff(confirmed_hubei)),
         delta_perc_lombardy = delta_lombardy/(lag(`confirmed Lombardy`)),
         delta_perc_hubei = delta_hubei/(lag(confirmed_hubei)))-> hubei_lombardy

# hubei_lombardy %>%
#   select(t,delta_perc_hubei,delta_perc_lombardy) %>%
#   gather(key = "region", value= "percentage_variation", -t) %>%
#   mutate(region = gsub("delta_perc_","",region)) %>%
#   ggplot(aes(x = t, y = percentage_variation, group = region, colour = region))+
#   geom_line()+
#   geom_point()



  
```


## Italy NCOV-19 outbreak

For personal reasons I am trying to track the number of NCOV-19 confirmed cases in Italy as well as the number of deaths (since I live in Italy, it is not difficult to guess the personal reason...). I am thus regularly monitoring news from the italian official sources like "Regione Lombardia" and "Protezione Civile".

You can find on a [Google Sheet](https://docs.google.com/spreadsheets/d/1mnhZe6_5m1wtLqDaTU-JzXrAHd0OKV7Uhrkh6G2BFn0/edit?usp=sharing)  the raw data I am collecting.

### number of confirmed cases and deaths in Italy

Here is an attempt to visualize historical series of total confirmed cases and deaths

```{r echo = FALSE, warning= FALSE, message= FALSE}
italy_data %>% 
  gather(key = "metric", value = "value", -date  ) %>% 
  ggplot(aes(x = date, y = value, group = metric, colour = metric, label = value))+
  geom_line()+
  geom_point()+
  ggrepel::geom_text_repel(colour = "gray20")+
  theme_minimal()+
  theme(legend.position = "bottom")+
  labs(title= "number of confirmed cases and deaths",
       subtitle= "log 10 scale",
       x = "date", y = "number of cases", caption = "source: italian 'Protezione Civile'")+
  scale_y_log10()
```

### daily change in confirmed cases in Italy

and finally here a visualization of daily change in confirmed cases:


```{r echo = FALSE, warning= FALSE, message= FALSE}
italy_data %>% 
  select(date, confirmed) %>%
  mutate(delta = c(0,diff(confirmed)),
         delta_perc = (delta/(lag(confirmed))) ) %>% 
         ggplot(aes(x = date,y = delta_perc, label = round(delta_perc,2)))+
  geom_line(colour = "gray80")+
  geom_point(colour ="navyblue")+
    ggrepel::geom_text_repel(colour = "gray20")+
  theme_minimal()+
  theme(legend.position = "bottom")+
  labs(title= "daily percentage change in total confirmed cases, Italy",
       x = "date", y = "% change in confirmed cases", caption = "source: italian 'Protezione Civile'")
```


It is interesting to compare this trend with the one observed in Mainland China

```{r echo = FALSE, warning = FALSE, message= FALSE}
world_data %>% select(-c(Lat, Long)) %>% 
  gather(key= "date", value = "confirmed", -c(`Province/State`, `Country/Region`)) %>% 
    janitor::clean_names() %>% 
  mutate(date = lubridate::parse_date_time(date,"mdy"),
         confirmed_hubei = confirmed) %>% 
  filter(country_region == "Mainland China") %>% 
  group_by(date) %>% 
  summarise(confirmed = sum(confirmed)) %>% 
  mutate(delta    = c(0,diff(confirmed)),
         delta_perc = delta/(lag(confirmed))) %>% 
  ggplot(aes(x = date, y = delta_perc, label = round(delta_perc,2)))+
  geom_line(colour = "gray80")+
  geom_point(colour ="navyblue")+
  theme_minimal()+
  ggrepel::geom_text_repel( segment.alpha = 0.2, segment.size = 0.3)+
  labs(title = "daily change in total confirmed cases in Mainland China",
      y = "% change in confirmed cases",
       x = "date",caption = "source: https://systems.jhu.edu/research/public-health/ncov/")
```

The italian level is aligned with the chinese one during the first part of the outbreak.

### daily change in confirmed cases in Lombardy

As you probably already know the most serious coronavirus outbreak started directly in Lombardy, where I currently live and I am writing from. I am therefore taking separared note of number related this region. You can find them on the [Google Sheet](https://docs.google.com/spreadsheets/d/1mnhZe6_5m1wtLqDaTU-JzXrAHd0OKV7Uhrkh6G2BFn0/edit?usp=sharing) and the daily change plotted below:

```{r echo = FALSE, warning= FALSE, message= FALSE}
Lombardy_data %>% 
   mutate(delta_lombardy = c(0,diff(`confirmed Lombardy`)),
         delta_perc = delta_lombardy/(lag(`confirmed Lombardy`))) %>% 
  ggplot(aes(x = date, y = delta_perc,label = round(delta_perc,2)))+
  geom_line(colour = "gray80")+
  geom_point(colour ="navyblue")+
  theme_minimal()+
  ggrepel::geom_text_repel( segment.alpha = 0.2, segment.size = 0.3)+
  labs(title = "daily change in total confirmed cases in Lombardy",
       source = "",
      y = "% change in confirmed cases",
       x = "date",caption = "source: 'Regione Lombardia' news service https://www.lombardianotizie.online")
```


### comparison between Lombardy and Hubei province

Since Lombardy is the first place where coronavirus really appeared in Italy, and it currently is the region where the main outbreak is observed, I thought it would have been interesting to compare the shape of the cumulated number of confirmed cases measured in Lombardy with the same number measured in Hubei from the beginning of the outbreak.

```{r echo = FALSE, warning= FALSE, message= FALSE}
hubei_lombardy %>%
  select(t,`confirmed Lombardy`,confirmed_hubei) %>% 
  gather(key = "region", value= "confirmed", -t) %>%
  mutate(region = gsub("_","",gsub("confirmed","",region))) %>% 
  ggplot(aes(x = t, y = confirmed, group =region, colour = region, label = scales::comma(confirmed)))+
  #geom_smooth(fullrange = TRUE)+
  geom_point()+
  geom_line()+
  scale_y_log10(labels = scales::comma)+
  ggrepel::geom_text_repel(size = 3, colour = "grey20", segment.alpha = 0.2, segment.size = 0.3)+
  theme_minimal()+
  theme(legend.position = "bottom")+
  labs(title = "comparison between Lombardy and Hubei daily number of cumulated cases\nfrom the beginning of the outbreak",
       subtitle = "values on Log10 scale",
       caption = "source: Hubei data from https://systems.jhu.edu/research/public-health/ncov/,\nLombardy data from 'Regione Lombardia' news service https://www.lombardianotizie.online",
       x = "days from beginning of the outbreak (22 of January for Hubei, 20 of February for Lombardy)",
       y = "total confirmed cases")
```

We can see quite a similar pattern, even if at the moment it is not possible to predict which will be the final shape of the curve. 
